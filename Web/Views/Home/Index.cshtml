@inherits System.Web.Mvc.WebViewPage<Web.Controllers.WatchedList>

@{
    View.Title = "Home Page";
}

<div class="container"> 
    <h2>Track What You've Watched</h2>
    
    @if (HttpContext.Current.User.Identity.IsAuthenticated) { 
    
        <div id="search">
            @using(Html.BeginForm("Index", "Home")) {
                <label for="searchSeriesName">Find a Series to Watch:</label>
                <input id="searchSeriesName" name="searchSeriesName" type="search" />
                <input type="submit" value="Search" class="button" />
            }
        </div>

        if (Model.SearchResults != null) {
        <div id="searchResults">
            <h5>Select a Series to Watch</h5>

            @using(Html.BeginForm("WatchSeries", "Home")) {
                <ul>
                    @foreach(var sr in Model.SearchResults) { 
                        <li>
                            <input type="checkbox" name="SeriesIds" value="@sr.Id" />
                            @sr.SeriesName
                        </li>
                    }
                </ul>
                <input type="submit" value="Add to Series List" class="button" />
            }
        </div>
        }

        <div id="series" class="column span-8 listingbox">
            <h4>Series</h4>

            <ul>
                @foreach(var ss in Model.WatchedSerieses) { 
                    <li@(ss.SeriesId == Model.SelectedSeriesId ? " class=selected" : "")>
                        @Html.ActionLink(ss.Series.SeriesName,"series", new { id = ss.SeriesId })
                    </li>
                }
            </ul>
        </div>

        <div id="episodes" class="column span-11 listingbox" data-seriesid="@Model.SelectedSeriesId">
            <h4>Episodes</h4>

            @if (Model.WatchedEpisodes != null) {
                using(Html.BeginForm("WatchEpisodes", "Home", new { SelectedSeriesId = Model.SelectedSeriesId })) {
                    <ul>
                        @foreach (var group in Model.WatchedEpisodes.GroupBy(oo => oo.Season)) {

                        <li>Season @group.Key
                            <ul>

                                @foreach (var ee in group) { 
                                    <li@(ee.Watched ? " class=watched" : "")>
                                        <input type="checkbox" id="EpisodeIds" name="EpisodeIds" value="@ee.EpisodeId"@(ee.Watched ? " checked=checked" : "") />
                                        @ee.EpisodeNumber - @ee.EpisodeTitle
                                    </li>
                                }
                            </ul>
                        </li>

                        }
                    </ul>
                    Html.HiddenFor(oo => oo.SelectedSeriesId);
                    <input id="btnSaveWatched" type="submit" value="Save Watched Episodes" class="button" />
                }
            } else {
                <p>[Select a Series]</p>
            }
        </div>
    } else {

        <p>@Html.ActionLink("Login or Signup to track shows.","create","session")</p>

    }
</div>